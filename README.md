# DerpyJSON

DerpyJSON is a utility for cleaning and parsing malformed JSON strings. It aims to "underp" JSON that may have been poorly generated, such as JSON responses from large language models (LLMs) that might contain errors like trailing commas, missing brackets, unquoted keys, or embedded comments.

## Key Features

- **underp(str)**: Attempts to clean up the provided string so that it can be parsed as valid JSON. This includes fixing issues like:
  - Extracting the first valid JSON segment from a larger string.
  - Removing various types of comments (`//`, `#`, `/* ... */`).
  - Wrapping unquoted keys in double quotes.
  - Removing trailing commas.
  - Balancing unmatched brackets.

- **parse(str)**: Uses `underp` to clean up the input string and then attempts to parse it into a JavaScript object. If parsing fails, it logs a warning.

- **stringify(obj, space)**: A simple wrapper around `JSON.stringify` for pretty-printing JSON objects.

## Example Usage

```typescript
import { DerpyJSON } from './DerpyJSON';

const malformedJson = `{
  foo: "bar", // comment
  baz: [1, 2, 3, ],
  qux: /* multi-line comment */ "quux"
}`;

const cleanedJson = DerpyJSON.underp(malformedJson);
console.log(cleanedJson); // Outputs the cleaned JSON string

const parsed = DerpyJSON.parse(malformedJson);
console.log(parsed); // Outputs the parsed JavaScript object
```

## When to Use DerpyJSON

DerpyJSON is particularly useful when working with JSON that may have been generated by a source that isn't fully reliable. Modern use cases include:

- **Salvaging bad LLM outputs**: Large language models might return JSON-like structures that don't quite conform to the JSON standard. DerpyJSON can help clean these outputs to make them usable in downstream applications.

- **Dealing with non-strict APIs**: Sometimes, APIs or legacy systems return JSON with slight deviations from the standard, like trailing commas or comments. DerpyJSON helps to make these responses usable without needing major manual adjustments.

## Methods Overview

- **underp(str: string | null): any**
  - Cleans up a JSON-like string, fixing common issues to make it parseable.

- **parse(str: string): any**
  - Cleans up the string using `underp` and then parses it. If parsing fails, it returns `null` and logs a warning.

- **stringify(obj: any, space?: any): string**
  - Converts a JavaScript object to a JSON string, with optional pretty-print spacing.

## Limitations

- **Partial Fixes**: `underp` attempts to fix common issues but cannot guarantee correctness for all malformed inputs.
- **Heuristics-based**: The cleanup process uses heuristics, which might not be suitable for all use cases. Always validate the cleaned JSON when possible.

## Contributing

If you find an edge case that DerpyJSON cannot handle, contributions are welcome! Please submit an issue or a pull request to help improve the utility.

## License

MIT License.

